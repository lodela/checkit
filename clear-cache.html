<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Limpiando Cache...</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background: #dc3545;
        color: white;
      }
      .container {
        text-align: center;
        padding: 40px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
      }
      h1 {
        font-size: 48px;
        margin: 0 0 20px 0;
      }
      p {
        font-size: 18px;
        margin: 10px 0;
      }
      button {
        margin-top: 20px;
        padding: 15px 30px;
        font-size: 18px;
        background: white;
        color: #dc3545;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }
      button:hover {
        background: #f0f0f0;
      }
      .log {
        margin-top: 20px;
        text-align: left;
        max-height: 300px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ—‘ï¸ Limpieza de CachÃ©</h1>
      <p id="status">Preparando limpieza...</p>
      <div class="log" id="log"></div>
      <button onclick="limpiarYRecargar()">ğŸ”„ Ir a la App Limpia</button>
    </div>

    <script>
      const log = document.getElementById('log');
      const status = document.getElementById('status');

      function addLog(msg) {
        console.log(msg);
        log.innerHTML += msg + '<br>';
        log.scrollTop = log.scrollHeight;
      }

      async function limpiarCache() {
        addLog('ğŸš€ Iniciando limpieza...');

        // 1. Desregistrar service workers
        if ('serviceWorker' in navigator) {
          const registrations =
            await navigator.serviceWorker.getRegistrations();
          addLog(`ğŸ“‹ Service Workers encontrados: ${registrations.length}`);

          for (let registration of registrations) {
            addLog('ğŸ—‘ï¸ Desregistrando: ' + registration.scope);
            await registration.unregister();
          }
          addLog('âœ… Service Workers desregistrados');
        }

        // 2. Limpiar todas las cachÃ©s
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          addLog(`ğŸ“¦ CachÃ©s encontradas: ${cacheNames.length}`);

          for (let cacheName of cacheNames) {
            addLog('ğŸ—‘ï¸ Eliminando cache: ' + cacheName);
            await caches.delete(cacheName);
          }
          addLog('âœ… CachÃ©s eliminadas');
        }

        // 3. Limpiar localStorage
        addLog('ğŸ—‘ï¸ Limpiando localStorage...');
        localStorage.clear();
        addLog('âœ… localStorage limpio');

        // 4. Limpiar sessionStorage
        addLog('ğŸ—‘ï¸ Limpiando sessionStorage...');
        sessionStorage.clear();
        addLog('âœ… sessionStorage limpio');

        status.textContent = 'âœ… Limpieza completada! Haz clic para continuar.';
        addLog('ğŸ‰ LIMPIEZA COMPLETA!');
      }

      function limpiarYRecargar() {
        window.location.href = '/index.html?nocache=' + Date.now();
      }

      // Ejecutar limpieza automÃ¡ticamente
      limpiarCache();
    </script>
  </body>
</html>
